<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARHIVE | Infinite Canvas</title>
    <style>
        :root {
            --bg-color: #000;
            --accent: #00ff00;
            --panel-w: 400px;
            --item-size: 180px; /* Smaller items */
            --gap: 250px;       /* Massive gaps */
        }

        * {
            user-select: none;
            -webkit-user-select: none;
            box-sizing: border-box;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background: var(--bg-color);
            color: #fff; font-family: 'Inter', sans-serif;
            overflow: hidden;
        }

        /* Loading Screen (1s) */
        #loader {
            position: fixed; inset: 0;
            background: #000; z-index: 1000;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            transition: opacity 0.5s ease;
        }
        .loader-text { font-weight: 900; letter-spacing: 15px; font-size: 14px; margin-bottom: 20px; animation: pulse 1s infinite; }
        .loader-bar { width: 150px; height: 1px; background: #222; position: relative; overflow: hidden; }
        .loader-progress { position: absolute; width: 100%; height: 100%; background: var(--accent); transform: translateX(-100%); animation: load 1s linear forwards; }
        @keyframes load { to { transform: translateX(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        .header {
            position: fixed; top: 0; width: 100%; padding: 30px;
            display: flex; justify-content: space-between; z-index: 100;
            align-items: center; pointer-events: none;
        }
        .header > div, .nav-links { pointer-events: auto; }
        .nav-links { display: flex; gap: 20px; }
        .nav-item {
            background: none; border: none; color: white; opacity: 0.5;
            cursor: pointer; text-transform: uppercase; font-size: 11px;
            letter-spacing: 2px; transition: 0.3s;
        }
        .nav-item.active { opacity: 1; color: var(--accent); }

        #viewport {
            width: 100vw; height: 100vh;
            cursor: grab; overflow: hidden;
            position: relative; touch-action: none;
        }

        /* Hover Focus Logic with Delay */
        #viewport:has(.item:hover) .item:not(:hover) {
            filter: blur(30px); /* Requested blur strength */
            opacity: 0.2;
            transition-delay: 0.1s; /* Subtle entry delay */
        }

        .item {
            position: absolute;
            width: var(--item-size);
            aspect-ratio: 1 / 1;
            border-radius: 2px;
            overflow: hidden;
            background: #111;
            will-change: transform, filter;
            /* Smooth transition for both entering and exiting hover focus */
            transition: filter 0.8s cubic-bezier(0.23, 1, 0.32, 1), 
                        opacity 0.8s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .item img {
            width: 100%; height: 100%;
            object-fit: cover;
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            pointer-events: none;
        }
        .item:hover { filter: blur(0px) !important; opacity: 1 !important; transition-delay: 0s !important; }
        .item:hover img { transform: scale(1.1); }

        /* Sidebar & Layout */
        #side-panel {
            position: fixed; right: -450px; top: 0;
            width: var(--panel-w); height: 100%;
            background: #050505; border-left: 1px solid #1a1a1a;
            z-index: 200; transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            padding: 80px 40px;
        }
        #side-panel.open { transform: translateX(-450px); }
        .close-btn { cursor: pointer; font-size: 32px; margin-bottom: 20px; opacity: 0.5; }
        .panel-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 2px; margin-bottom: 30px; }

        #dimmer {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            opacity: 0; pointer-events: none; transition: 0.5s; z-index: 150;
        }
        #dimmer.active { opacity: 1; pointer-events: auto; }

        @media (max-width: 768px) {
            :root { --item-size: 120px; --gap: 100px; --panel-w: 100%; }
            .header { padding: 20px; flex-direction: column; gap: 15px; text-align: center; }
            #side-panel.open { transform: translateX(-100%); right: -100%; }
        }
    </style>
</head>
<body>

    <div id="loader">
        <div class="loader-text">ARHIVE</div>
        <div class="loader-bar"><div class="loader-progress"></div></div>
    </div>

    <header class="header">
        <div style="font-weight: 900; letter-spacing: -1px;">GEMINI_STUDIO</div>
        <nav class="nav-links">
            <button class="nav-item active" onclick="filterItems('all', this)">All</button>
            <button class="nav-item" onclick="filterItems('foundation', this)">System</button>
            <button class="nav-item" onclick="filterItems('expression', this)">Visuals</button>
        </nav>
    </header>

    <div id="dimmer" onclick="closePanel()"></div>
    <aside id="side-panel">
        <div class="close-btn" onclick="closePanel()">Ã—</div>
        <div id="panel-content"></div>
    </aside>

    <div id="viewport"></div>

    <script>
        const basePhotos = [
            { type: 'foundation', title: 'Geometric Order', imgId: '1614850523296-d8c1af93d400' },
            { type: 'expression', title: 'Abstract Light', imgId: '1550684848-fac1c5b4e853' },
            { type: 'foundation', title: 'Digital Flow', imgId: '1618005182384-a83a8bd57fbe' },
            { type: 'expression', title: 'Neon Textures', imgId: '1633167606207-d840b5070fc2' },
            { type: 'foundation', title: 'Minimal Forms', imgId: '1604871000636-074fa5117945' },
            { type: 'expression', title: 'Dark Gradient', imgId: '1618556450991-2f1af64e8191' }
        ];

        const PHOTOS = Array.from({ length: 36 }, (_, i) => ({
            ...basePhotos[i % basePhotos.length],
            id: i,
            url: `https://images.unsplash.com/photo-${basePhotos[i % basePhotos.length].imgId}?auto=format&fit=crop&w=600&q=80`
        }));

        const viewport = document.getElementById('viewport');
        const getItemSize = () => parseInt(getComputedStyle(document.documentElement).getPropertyValue('--item-size'));
        const getGapSize = () => parseInt(getComputedStyle(document.documentElement).getPropertyValue('--gap'));
        
        const cols = 8;
        const rows = 6;
        let itemSize, gap, fullW, fullH;

        let pos = { x: 0, y: 0 };
        let vel = { x: 0, y: 0 };
        let isDragging = false;
        let lastMouse = { x: 0, y: 0 };
        let activeItems = [];

        function getSmartGridData() {
            const grid = [];
            for (let r = 0; r < rows; r++) {
                grid[r] = [];
                for (let c = 0; c < cols; c++) {
                    const prevL = c > 0 ? grid[r][c-1] : null;
                    const prevU = r > 0 ? grid[r-1][c] : null;
                    let available = PHOTOS.filter(p => p.id !== prevL?.id && p.id !== prevU?.id);
                    const choice = available[Math.floor(Math.random() * available.length)];
                    grid[r][c] = choice;
                }
            }
            return grid.flat();
        }

        function init() {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    document.getElementById('loader').style.opacity = '0';
                    setTimeout(() => document.getElementById('loader').remove(), 500);
                }, 1000);
            });

            viewport.innerHTML = '';
            const gridData = getSmartGridData();
            itemSize = getItemSize();
            gap = getGapSize();

            gridData.forEach((data, i) => {
                const el = document.createElement('div');
                el.className = 'item';
                el.innerHTML = `<img src="${data.url}" alt="work">`;
                el.onclick = () => { if (Math.abs(vel.x) < 2 && Math.abs(vel.y) < 2) openPanel(data); };
                viewport.appendChild(el);
                activeItems.push({ 
                    el, data, 
                    origX: (i % cols) * (itemSize + gap), 
                    origY: Math.floor(i / cols) * (itemSize + gap) 
                });
            });
            requestAnimationFrame(update);
        }

        const handleDown = (x, y) => { isDragging = true; lastMouse = { x, y }; };
        const handleMove = (x, y) => {
            if (!isDragging) return;
            const dx = x - lastMouse.x;
            const dy = y - lastMouse.y;
            pos.x += dx; pos.y += dy;
            vel = { x: dx, y: dy };
            lastMouse = { x, y };
        };

        window.onmousedown = e => handleDown(e.clientX, e.clientY);
        window.onmousemove = e => handleMove(e.clientX, e.clientY);
        window.onmouseup = () => isDragging = false;
        window.ontouchstart = e => handleDown(e.touches[0].clientX, e.touches[0].clientY);
        window.ontouchmove = e => handleMove(e.touches[0].clientX, e.touches[0].clientY);
        window.ontouchend = () => isDragging = false;

        function update() {
            if (!isDragging) {
                pos.x += vel.x; pos.y += vel.y;
                vel.x *= 0.95; vel.y *= 0.95;
            }

            itemSize = getItemSize();
            gap = getGapSize();
            fullW = cols * (itemSize + gap);
            fullH = rows * (itemSize + gap);

            activeItems.forEach(item => {
                let x = (item.origX + pos.x) % fullW;
                let y = (item.origY + pos.y) % fullH;
                if (x < -itemSize) x += fullW;
                if (y < -itemSize) y += fullH;
                if (x > fullW - itemSize) x -= fullW;
                if (y > fullH - itemSize) y -= fullH;
                item.el.style.transform = `translate3d(${x}px, ${y}px, 0)`;
            });
            requestAnimationFrame(update);
        }

        function openPanel(data) {
            document.getElementById('panel-content').innerHTML = `
                <img src="${data.url}" class="panel-img">
                <h2 style="margin:0; font-size:24px;">${data.title}</h2>
                <p style="color:var(--accent); font-size:10px; letter-spacing:2px; margin-top:10px;">${data.type.toUpperCase()}</p>
                <p style="opacity:0.6; line-height:1.8; margin-top:20px;">Entry #${data.id} in the infinite ARHIVE.</p>
            `;
            document.getElementById('side-panel').classList.add('open');
            document.getElementById('dimmer').classList.add('active');
        }

        function closePanel() {
            document.getElementById('side-panel').classList.remove('open');
            document.getElementById('dimmer').classList.remove('active');
        }

        function filterItems(type, btn) {
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            activeItems.forEach(item => {
                const isMatch = type === 'all' || item.data.type === type;
                item.el.style.opacity = isMatch ? '1' : '0.05';
                item.el.style.pointerEvents = isMatch ? 'auto' : 'none';
            });
        }

        init();
    </script>
</body>
</html>
